# Instalando os pacotes
```{r}
# install.packages("rpart")
library(rpart)
# install.packages("rpart.plot")
library(rpart.plot)
# install.packages("dplyr")
# library(dplyr)
```

# Carregando os dados
```{r}
datasetOriginal <- read.csv2('./datasets/survey_results_public.csv', header = TRUE, sep = ',')
```

# Definindo constantes
```{r}
columns = c("ConvertedCompYearly", "YearsCode", "YearsCodePro", "Country", "OrgSize")
limit = 50
```


# Populando YearsCodePro com o valor de YearsCode, caso YearsCodePro seja NA
```{r}
datasetOriginal$YearsCodePro <- ifelse(is.na(datasetOriginal$YearsCodePro), datasetOriginal$YearsCode, datasetOriginal$YearsCodePro)
```

# Criando dataset para a arvore e removendo os valores nulos
```{r}
datasetLimpo <- datasetOriginal[, columns]
datasetLimpo <- head(na.omit(datasetLimpo)[, columns], limit)
datasetLimpo
```

# Transformando os dados em ranges
```{r}
# < 25.000
# >= 25.000 < 50.000
# >= 50.000 < 100.000
# >= 100.000 < 150.000
# >= 150.000 < 200.000
# >= 200.000 < 250.000
# >= 250.000 < 300.000
# >= 300.000
dataset_comp_range = datasetTree
dataset_comp_range$ConvertedCompYearly[
  dataset_comp_range$ConvertedCompYearly < 12500
] = "< 12.500"
dataset_comp_range$ConvertedCompYearly[
  dataset_comp_range$ConvertedCompYearly >= 12500 & dataset_comp_range$ConvertedCompYearly < 50000
] = ">= $25.000 and < $50.000"
dataset_comp_range$ConvertedCompYearly[
  dataset_comp_range$ConvertedCompYearly >= 25000 & dataset_comp_range$ConvertedCompYearly < 50000
] = ">= $25.000 and < $50.000"
dataset_comp_range$ConvertedCompYearly[
  dataset_comp_range$ConvertedCompYearly >= 50000 & dataset_comp_range$ConvertedCompYearly < 100000
] = ">= $50.000 and < $100.000"
dataset_comp_range$ConvertedCompYearly[
  dataset_comp_range$ConvertedCompYearly >= 100000 & dataset_comp_range$ConvertedCompYearly < 150000
] = ">= $100.000 and < $150.000"
dataset_comp_range$ConvertedCompYearly[
  dataset_comp_range$ConvertedCompYearly >= 150000 & dataset_comp_range$ConvertedCompYearly < 200000
] = ">= $150.000 and < $200.000"
dataset_comp_range$ConvertedCompYearly[
  dataset_comp_range$ConvertedCompYearly >= 200000 & dataset_comp_range$ConvertedCompYearly < 250000
] = ">= $200.000 and < $250.000"
dataset_comp_range$ConvertedCompYearly[
  dataset_comp_range$ConvertedCompYearly >= 250000 & dataset_comp_range$ConvertedCompYearly < 300000
] = ">= $250.000 and < $300.000"
dataset_comp_range$ConvertedCompYearly[
  dataset_comp_range$ConvertedCompYearly >= 300000
] = ">= $300.000"
dataset_comp_range$ConvertedCompYearly = as.factor(dataset_comp_range$ConvertedCompYearly)
dataset_comp_range$OrgSize = as.factor(dataset_comp_range$OrgSize)
dataset_comp_range
```

```{r}
# < 1
# >= 1 < 3
# >= 3 < 6
# >= 6 < 10
# >= 10 < 20
# >= 20
dataset_comp_range$YearsCode[
  dataset_comp_range$YearsCode >= 1 & dataset_comp_range$YearsCode < 3
] = ">= 1 and < 3"
dataset_comp_range$YearsCode[
  dataset_comp_range$YearsCode >= 3 & dataset_comp_range$YearsCode < 6
] = ">= 3 and < 6"
dataset_comp_range$YearsCode[
  dataset_comp_range$YearsCode >= 6 & dataset_comp_range$YearsCode < 10
] = ">= 6 and < 10"
dataset_comp_range$YearsCode[
  dataset_comp_range$YearsCode >= 10 & dataset_comp_range$YearsCode < 20
] = ">= 10 and < 20"
dataset_comp_range$YearsCode[
  dataset_comp_range$YearsCode >= 20
] = ">= 20"
dataset_comp_range$YearsCode = as.factor(dataset_comp_range$YearsCode)

dataset_comp_range$YearsCodePro[
  dataset_comp_range$YearsCodePro >= 1 & dataset_comp_range$YearsCodePro < 3
] = ">= 1 and < 3"
dataset_comp_range$YearsCodePro[
  dataset_comp_range$YearsCodePro >= 3 & dataset_comp_range$YearsCodePro < 6
] = ">= 3 and < 6"
dataset_comp_range$YearsCodePro[
  dataset_comp_range$YearsCodePro >= 6 & dataset_comp_range$YearsCodePro < 10
] = ">= 6 and < 10"
dataset_comp_range$YearsCodePro[
  dataset_comp_range$YearsCodePro >= 10 & dataset_comp_range$YearsCodePro < 20
] = ">= 10 and < 20"
dataset_comp_range$YearsCodePro[
  dataset_comp_range$YearsCodePro >= 20
] = ">= 20"
dataset_comp_range$YearsCodePro = as.factor(dataset_comp_range$YearsCodePro)
```



# Criando a Arvore de decisao
```{r}
datasetTree = head(dataset_comp_range, limit)
modelo_salario <- rpart(ConvertedCompYearly~YearsCode+YearsCodePro+Country,
                                  data=datasetTree,
                                  method="class",
                                  control=rpart.control(minsplit = 3, 
                                                        xval = 5),
                                  parms=list(split="Information"))
modelo_salario
```

```{r}
arvore_decisao <- rpart.plot(modelo_salario, type = 2)
arvore_decisao
```
